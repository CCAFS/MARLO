<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC 
"-//Apache Software Foundation//DTD Struts Configuration 2.5//EN" 
  "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>

  <package name="rest" namespace="/api" extends="rest-default">

    <interceptors>
      <interceptor name="restApiAuthorization"
        class="org.cgiar.ccafs.marlo.interceptor.RestApiAuthorizationInterceptor" />
      <interceptor-stack name="marloRestApiStack">
        <interceptor-ref name="restDefaultStack" />
        <interceptor-ref name="restApiAuthorization" />
      </interceptor-stack>
    </interceptors>
    
    <!--  Leaving this here, but unfortunately this doesn't work when using CuRL unless the accept header allows html
     so that the struts2 HtmlHandler is used.  The JacksonHandler on the other hand serializes the Authorization 
     Exception to JSON rather than sending the 403-response.json file -->
    <global-results>
      <result name="403">
        /rest/403-response.json
      </result>
    </global-results>

    <global-exception-mappings>
      <exception-mapping exception="org.apache.shiro.authz.AuthorizationException"
        result="403" />
    </global-exception-mappings>

    <action name="institutions"
      class="org.cgiar.ccafs.marlo.rest.InstitutionController">
      <interceptor-ref name="marloRestApiStack"></interceptor-ref>
    </action>
    <action name="crps" class="org.cgiar.ccafs.marlo.rest.CrpController">
      <interceptor-ref name="marloRestApiStack"></interceptor-ref>
    </action>
  </package>
</struts>

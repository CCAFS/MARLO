DROP VIEW IF EXISTS `user_permissions`;
CREATE VIEW `user_permissions` AS select `u`.`id` AS `id`,`r`.`acronym` AS `ro_acronym`,`r`.`id` AS `role_id`,replace(`p`.`permission`,'{0}',`cp`.`acronym`) AS `permission`,NULL AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from ((((((`users` `u` left join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) where ((`p`.`type` = 0) and (`r`.`id` <> 17)) union select `u`.`id` AS `id`,`r`.`acronym` AS `ro_acronym`,`r`.`id` AS `role_id`,replace(`p`.`permission`,'{0}',`cp`.`acronym`) AS `permission`,NULL AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((`users` `u` left join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crps` `cp`) where ((`p`.`type` = 0) and (`r`.`id` = 17)) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `replace(replace(``p``.``permission``,'{0}',cp.acronym),'{1}',pro.id)`,NULL AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from ((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crp_program_leaders` `cprog` on(((`cprog`.`user_id` = `u`.`id`) and (`cprog`.`is_active` = 1)))) join `crp_programs` `pro` on(((`pro`.`id` = `cprog`.`crp_program_id`) and (`pro`.`program_type` = 1) and (`pro`.`is_active` = 1)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) where ((`p`.`type` = 3) and (`r`.`acronym` = 'FPL')) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `name_exp_32`,`pro`.`id` AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) join `projects` `pro` on(((`pro`.`crp_id` = `cp`.`id`) and (`pro`.`is_active` = 1)))) join `liaison_institutions` `lin` on((`lin`.`id` = `pro`.`liaison_institution_id`))) join `liaison_users` `lus` on(((`lus`.`institution_id` = `lin`.`institution_id`) and (`u`.`id` = `lus`.`user_id`)))) where ((`p`.`type` = 1) and (`r`.`acronym` in ('PMU','ML','CP'))) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `name_exp_39`,`pro`.`id` AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from ((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) join `projects` `pro` on(((`pro`.`crp_id` = `cp`.`id`) and (`pro`.`is_active` = 1)))) join `liaison_users` `lus` on(((`lus`.`id` = `pro`.`liaison_user_id`) and (`u`.`id` = `lus`.`user_id`)))) where ((`p`.`type` = 1) and (`r`.`acronym` in ('PMU','ML','CP'))) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `name_exp_46`,`pro`.`id` AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) join `projects` `pro` on(((`pro`.`crp_id` = `cp`.`id`) and (`pro`.`is_active` = 1)))) join `crp_program_leaders` `cpl` on(((`cpl`.`user_id` = `u`.`id`) and (`cpl`.`is_active` = 1)))) join `project_focuses` `pf` on(((`pf`.`program_id` = `cpl`.`crp_program_id`) and (`pf`.`project_id` = `pro`.`id`)))) where ((`p`.`type` = 1) and (`r`.`acronym` = 'FPL')) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `name_exp_46`,`pro`.`id` AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) join `projects` `pro` on(((`pro`.`crp_id` = `cp`.`id`) and (`pro`.`is_active` = 1)))) join `project_partners` `pp` on(((`pp`.`project_id` = `pro`.`id`) and (`pp`.`is_active` = 1)))) join `project_partner_persons` `pers` on(((`pp`.`id` = `pers`.`project_partner_id`) and (`pers`.`is_active` = 1) and (`pers`.`contact_type` = 'PL') and (`pers`.`user_id` = `u`.`id`)))) where ((`p`.`type` = 1) and (`r`.`acronym` = 'PL')) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `name_exp_46`,`pro`.`id` AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) join `projects` `pro` on(((`pro`.`crp_id` = `cp`.`id`) and (`pro`.`is_active` = 1)))) join `project_partners` `pp` on(((`pp`.`project_id` = `pro`.`id`) and (`pp`.`is_active` = 1)))) join `project_partner_persons` `pers` on(((`pp`.`id` = `pers`.`project_partner_id`) and (`pers`.`is_active` = 1) and (`pers`.`contact_type` = 'PC') and (`pers`.`user_id` = `u`.`id`)))) where ((`p`.`type` = 1) and (`r`.`acronym` = 'PC')) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`pro`.`id`) AS `name_exp_46`,`pro`.`id` AS `project_id`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `crp_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`crp_id` = `r`.`crp_id`)))) join `crps` `cp` on((`cp`.`id` = `crp`.`crp_id`))) join `projects_bilateral_cofinancing` `pro` on(((`pro`.`crp_id` = `cp`.`id`) and (`pro`.`is_active` = 1)))) where ((`p`.`type` = 1) and (`p`.`id` = 438)) ;

DROP VIEW IF EXISTS `user_permissions`;
CREATE VIEW `user_permissions` AS select `u`.`id` AS `id`,`r`.`acronym` AS `ro_acronym`,`r`.`id` AS `role_id`,replace(`p`.`permission`,'{0}',`cp`.`acronym`) AS `permission`,`cp`.`acronym` AS `center_acronym`,`p`.`id` AS `permission_id` from (((((`users` `u` left join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `research_centers` `cp`) where ((`p`.`type` = 0) and (`r`.`id` = 6)) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`ar`.`id`) AS `permission`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from ((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `center_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`center_id` = `r`.`center_id`)))) join `research_centers` `cp` on((`cp`.`id` = `crp`.`center_id`))) join `research_areas` `ar` on(((`ar`.`research_center_id` = `cp`.`id`) and (`ar`.`is_active` = 1)))) join `research_leaders` `cprog` on(((`cprog`.`user_id` = `u`.`id`) and (`cprog`.`is_active` = 1) and (`cprog`.`research_area_id` = `ar`.`id`)))) where ((`p`.`type` = 0) and (`r`.`acronym` = 'RAD')) union select `u`.`id` AS `id`,`r`.`acronym` AS `acronym`,`r`.`id` AS `rolid`,replace(replace(replace(`p`.`permission`,'{0}',`cp`.`acronym`),'{1}',`ar`.`id`),'{2}',`rprog`.`id`) AS `permission`,`cp`.`acronym` AS `crp_acronym`,`p`.`id` AS `permission_id` from (((((((((`users` `u` join `user_roles` `ro` on((`ro`.`user_id` = `u`.`id`))) join `roles` `r` on((`r`.`id` = `ro`.`role_id`))) join `role_permissions` `rp` on((`rp`.`role_id` = `r`.`id`))) join `permissions` `p` on((`p`.`id` = `rp`.`permission_id`))) join `center_users` `crp` on(((`u`.`id` = `crp`.`user_id`) and (`crp`.`center_id` = `r`.`center_id`)))) join `research_centers` `cp` on((`cp`.`id` = `crp`.`center_id`))) join `research_areas` `ar` on(((`ar`.`research_center_id` = `cp`.`id`) and (`ar`.`is_active` = 1)))) join `research_programs` `rprog` on(((`rprog`.`research_area_id` = `ar`.`id`) and (`ar`.`is_active` = 1)))) join `research_leaders` `cprog` on(((`cprog`.`user_id` = `u`.`id`) and (`cprog`.`is_active` = 1) and (`cprog`.`research_program_id` = `rprog`.`id`)))) where ((`p`.`type` = 0) and (`r`.`acronym` = 'RPL'))